<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NationPeek</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Custom Tailwind Configuration (for better aesthetics) */
        @layer base {
            :root {
                --color-primary: 66, 125, 234; /* #667eea */
                --color-secondary: 118, 75, 162; /* #764ba2 */
                --color-success: 79, 172, 254; /* #4facfe */
                --bg-light-start: 227, 242, 253; /* #e3f2fd */
                --bg-light-end: 144, 202, 249; /* #90caf9 */
                --bg-dark-start: 26, 26, 46; /* #1a1a2e */
                --bg-dark-end: 15, 52, 96; /* #0f3460 */
            }
        }
        
        .glass-card {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        [data-theme="dark"] .glass-card {
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-bg {
            background-image: linear-gradient(135deg, rgb(var(--color-primary)) 0%, rgb(var(--color-secondary)) 100%);
        }
        
        .hero-title-gradient {
            background-image: linear-gradient(135deg, rgb(var(--color-primary)) 0%, rgb(var(--color-secondary)) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .temp-gradient {
            background-image: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        /* Responsive Body Background */
        body {
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            background-attachment: fixed;
            min-height: 100vh;
            background-image: linear-gradient(135deg, rgb(var(--bg-light-start)) 0%, rgb(var(--bg-light-end)) 100%);
        }

        [data-theme="dark"] body {
            background-image: linear-gradient(135deg, rgb(var(--bg-dark-start)) 0%, rgb(var(--bg-dark-end)) 100%);
        }
    </style>
</head>

<body data-theme="light" class="text-gray-900 antialiased">
    <!-- Theme Toggle -->
    <button class="fixed top-5 right-5 z-50 rounded-full bg-white/70 backdrop-blur-md shadow-lg p-3 text-gray-700 transition duration-300 hover:bg-white focus:outline-none" onclick="toggleTheme()">
        <i id="themeIcon" class="fas fa-moon"></i>
    </button>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-gray-800/80 glass-card p-8 rounded-xl shadow-2xl text-white text-center">
            <div class="animate-spin w-8 h-8 border-4 border-white border-t-transparent rounded-full mb-4 mx-auto"></div>
            <h5 id="loadingText" class="text-lg font-semibold">Loading...</h5>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 md:py-12 max-w-4xl">
        <!-- Hero Section -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-extrabold hero-title-gradient mb-3 tracking-tight md:text-6xl">
                <i class="fas fa-globe-americas"></i> NationPeek
            </h1>
            <p class="text-xl text-gray-700 dark:text-gray-300">Discover countries and their capital city weather</p>
        </div>

        <!-- Search Section -->
        <div class="max-w-xl mx-auto mb-10">
            <div class="glass-card p-6 rounded-2xl">
                <form id="searchForm" onsubmit="searchCountry(event)">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-grow">
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input 
                                    type="text" 
                                    class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 dark:bg-gray-700 dark:text-gray-100" 
                                    id="countryInput" 
                                    placeholder="Enter country name..."
                                    required
                                >
                            </div>
                        </div>
                        <button type="submit" class="gradient-bg text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition duration-300 hover:scale-[1.02] active:scale-[0.98]" id="searchBtn">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </form>
                
                <div class="text-center mt-4">
                    <button type="button" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-6 rounded-full shadow-md transition duration-300" onclick="getCurrentLocation()">
                        <i class="fas fa-map-marker-alt"></i> Use My Location
                    </button>
                </div>
            </div>
        </div>

        <!-- Alert Messages -->
        <div id="alertContainer" class="mb-4"></div>

        <!-- Results Section -->
        <div id="resultSection" class="hidden">
            <!-- Country Header -->
            <div class="glass-card p-6 md:p-8 mb-6 rounded-2xl shadow-xl">
                <div class="flex items-center space-x-4">
                    <div id="countryFlag" class="text-6xl md:text-8xl leading-none"></div>
                    <div>
                        <h2 id="countryName" class="text-3xl md:text-4xl font-bold mb-1 dark:text-white"></h2>
                        <p id="countryCapital" class="text-lg md:text-xl text-gray-600 dark:text-gray-400">
                            <i class="fas fa-map-pin mr-2"></i> Capital: <span class="font-semibold"></span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- Population -->
                <div class="stat-card p-4 rounded-xl shadow-md transition hover:shadow-lg">
                    <div class="text-3xl mb-2 text-indigo-500"><i class="fas fa-users"></i></div>
                    <h5 class="text-sm font-medium uppercase text-gray-500 dark:text-gray-400">Population</h5>
                    <p id="countryPopulation" class="text-xl font-bold text-blue-600 dark:text-blue-400 mt-1">--</p>
                </div>
                
                <!-- Region -->
                <div class="stat-card p-4 rounded-xl shadow-md transition hover:shadow-lg">
                    <div class="text-3xl mb-2 text-green-500"><i class="fas fa-globe"></i></div>
                    <h5 class="text-sm font-medium uppercase text-gray-500 dark:text-gray-400">Region</h5>
                    <p id="countryRegion" class="text-lg font-bold text-green-600 dark:text-green-400 mt-1">--</p>
                </div>
                
                <!-- Area -->
                <div class="stat-card p-4 rounded-xl shadow-md transition hover:shadow-lg">
                    <div class="text-3xl mb-2 text-yellow-500"><i class="fas fa-expand-arrows-alt"></i></div>
                    <h5 class="text-sm font-medium uppercase text-gray-500 dark:text-gray-400">Area</h5>
                    <p id="countryArea" class="text-lg font-bold text-yellow-600 dark:text-yellow-400 mt-1">--</p>
                </div>
                
                <!-- Local Time -->
                <div class="stat-card p-4 rounded-xl shadow-md transition hover:shadow-lg">
                    <div class="text-3xl mb-2 text-red-500"><i class="fas fa-clock"></i></div>
                    <h5 class="text-sm font-medium uppercase text-gray-500 dark:text-gray-400">Local Time</h5>
                    <div id="localTime" class="text-2xl font-bold text-red-600 dark:text-red-400">--:--</div>
                    <div id="timezone" class="text-xs opacity-75 mt-1"></div>
                </div>
            </div>

            <!-- Weather Section -->
            <div class="glass-card p-6 md:p-8 rounded-2xl shadow-xl">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-white">
                    <i class="fas fa-cloud-sun text-blue-500 mr-2"></i> 
                    Current Weather in <span id="weatherCity" class="font-bold"></span>
                </h3>
                <div id="weatherContent" class="flex flex-wrap items-center gap-6">
                    <!-- Main Weather -->
                    <div class="flex items-center">
                        <img id="weatherIcon" class="w-20 h-20" src="" alt="Weather icon" onerror="this.onerror=null; this.src='https://placehold.co/80x80/cccccc/333333?text=N/A'">
                        <div>
                            <div id="temperature" class="text-5xl font-extrabold temp-gradient">--°C</div>
                            <div id="weatherDescription" class="text-xl capitalize text-gray-700 dark:text-gray-300"></div>
                        </div>
                    </div>

                    <!-- Details Grid -->
                    <div class="flex-grow grid grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Feels Like</div>
                            <div id="feelsLike" class="text-lg font-bold text-gray-800 dark:text-white mt-1">--°C</div>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Humidity</div>
                            <div id="humidity" class="text-lg font-bold text-gray-800 dark:text-white mt-1">--%</div>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Wind Speed</div>
                            <div id="windSpeed" class="text-lg font-bold text-gray-800 dark:text-white mt-1">-- m/s</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- FIX: Moved CONFIG object to the start of the script for global availability ---
        const CONFIG = {
            // NOTE: For security, never expose real API keys in client-side code in a production application.
            WEATHER_API_KEY: '$$WEATHER_API_KEY$$', 
            
            DEFAULT_UNITS: 'metric',
            REQUEST_TIMEOUT: 10000,
            
            ENDPOINTS: {
                WEATHER: 'https://api.openweathermap.org/data/2.5/weather',
                COUNTRIES: 'https://restcountries.com/v3.1',
                GEOCODING: 'https://api.bigdatacloud.net/data/reverse-geocode-client'
            }
        };

        // --- Global State and Utility Functions ---
        let timeInterval = null;

        // Theme management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const icon = document.getElementById('themeIcon');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            
            // Toggle text/background colors for dark mode based on Tailwind
            document.body.classList.toggle('text-gray-900', newTheme === 'light');
            document.body.classList.toggle('dark:text-white', newTheme === 'dark');
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const icon = document.getElementById('themeIcon');
            if (icon) {
                 icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
            
            // Initial body text color setup
            if (savedTheme === 'dark') {
                document.body.classList.remove('text-gray-900');
                document.body.classList.add('dark:text-white');
            }
        }

       // Show/hide loading
       function showLoading(text = 'Loading...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
            document.body.style.overflow = '';
        } 

        // Show alerts (uses simple in-place alert, no external bootstrap needed)
        function showAlert(message, type = 'danger') {
            const alertContainer = document.getElementById('alertContainer');
            const color = type === 'danger' ? 'red' : (type === 'warning' ? 'yellow' : 'blue');
            const icon = type === 'danger' ? 'fa-exclamation-triangle' : (type === 'warning' ? 'fa-exclamation-circle' : 'fa-info-circle');
            
            const alertHTML = `
                <div class="p-4 mb-4 text-sm text-${color}-800 rounded-lg bg-${color}-100 dark:bg-${color}-200 dark:text-${color}-800 flex items-center shadow fade-in" role="alert">
                    <i class="fas ${icon} mr-3"></i>
                    <div>${message}</div>
                    <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-transparent text-${color}-500 rounded-lg p-1.5 hover:bg-${color}-200 inline-flex items-center justify-center h-8 w-8" onclick="this.closest('div').remove()">
                        <span class="sr-only">Close alert</span>
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            // Use innerHTML to replace previous alert
            alertContainer.innerHTML = alertHTML;
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                const alertElement = alertContainer.querySelector('div');
                if (alertElement) {
                    alertElement.remove();
                }
            }, 5000);
        }

        // Format numbers
        function formatNumber(number) {
            return number.toLocaleString('en-US');
        }

        function formatPopulation(population) {
            if (population >= 1000000) {
                return (population / 1000000).toFixed(1) + 'M';
            } else if (population >= 1000) {
                return (population / 1000).toFixed(1) + 'K';
            }
            return formatNumber(population);
        }

        function formatArea(area) {
            return formatNumber(area) + ' km²';
        }

        // --- API Fetching Functions ---

        // Fetch country data
        async function fetchCountryData(countryName) {
            try {
                const response = await fetch(
                    `${CONFIG.ENDPOINTS.COUNTRIES}/name/${encodeURIComponent(countryName)}?fullText=true` // Using fullText=true for more accurate single result
                );
                
                if (!response.ok) {
                    throw new Error('Country not found');
                }
                
                const data = await response.json();
                const country = data[0];
                
                return {
                    name: country.name.common,
                    capital: country.capital ? country.capital[0] : 'N/A',
                    population: country.population,
                    region: country.region,
                    subregion: country.subregion,
                    area: country.area,
                    flag: country.flag,
                    timezones: country.timezones,
                    latlng: country.latlng,
                    capitalInfo: country.capitalInfo
                };
            } catch (error) {
                // Check for 404 specifically
                if (error.message.includes('404')) {
                    throw new Error('Country not found. Please check the spelling.');
                }
                throw new Error('Failed to fetch country data. Please check the country name and try again.');
            }
        }

        // Fetch weather data
        async function fetchWeatherData(cityName) {
            if (!CONFIG.WEATHER_API_KEY || CONFIG.WEATHER_API_KEY === '$$WEATHER_API_KEY$$') {
                console.error('Weather API key not configured or injected by GitHub Action.');
                throw new Error('Weather API service is unavailable.');
            }

            try {
                const response = await fetch(
                    `${CONFIG.ENDPOINTS.WEATHER}?q=${encodeURIComponent(cityName)}&appid=${CONFIG.WEATHER_API_KEY}&units=${CONFIG.DEFAULT_UNITS}`
                );
                
                if (!response.ok) {
                    throw new Error('Weather data not found');
                }
                
                return await response.json();
            } catch (error) {
                throw new Error('Failed to fetch weather data.');
            }
        }
        
        // Get timezone and time (Client-side implementation)
        async function getTimezoneTime(timezone) {
            try {
                const now = new Date();
                const options = {
                    timeZone: timezone,
                    hour12: true,
                    hour: 'numeric',
                    minute: 'numeric',
                    second: 'numeric'
                };
                
                return {
                    time: now.toLocaleTimeString('en-US', options),
                    timezone: timezone
                };
            } catch (error) {
                console.error('Timezone calculation error:', error);
                return {
                    time: 'Time unavailable',
                    timezone: timezone || 'N/A'
                };
            }
        }

        // Update time display (using the IANA timezone)
        function updateTimeDisplay(timezone) {
            if (timeInterval) {
                clearInterval(timeInterval);
            }
            
            function updateTime() {
                try {
                    const now = new Date();
                    const options = {
                        timeZone: timezone,
                        hour12: true,
                        hour: 'numeric',
                        minute: 'numeric',
                        second: 'numeric'
                    };
                    
                    const time = now.toLocaleTimeString('en-US', options);
                    document.getElementById('localTime').textContent = time;
                    document.getElementById('timezone').textContent = timezone;
                } catch (error) {
                    // This block handles invalid timezones gracefully
                    document.getElementById('localTime').textContent = 'Time unavailable';
                    document.getElementById('timezone').textContent = 'Timezone Error';
                    clearInterval(timeInterval); // Stop trying to update
                }
            }
            
            updateTime();
            // Check if timezone is valid before setting interval
            if (timezone && timezone.includes('/')) {
                timeInterval = setInterval(updateTime, 1000);
            }
        }

        // Display results
        function displayResult(countryData, weatherData) {
            // Country basic info
            document.getElementById('countryFlag').textContent = countryData.flag;
            document.getElementById('countryName').textContent = countryData.name;
            document.getElementById('countryCapital').querySelector('span').textContent = countryData.capital;
            
            // Stats
            document.getElementById('countryPopulation').textContent = formatPopulation(countryData.population);
            document.getElementById('countryRegion').textContent = countryData.region + 
                (countryData.subregion ? ` (${countryData.subregion})` : '');
            document.getElementById('countryArea').textContent = formatArea(countryData.area);
            
            // Time
            if (countryData.timezones && countryData.timezones[0]) {
                const timezoneId = countryData.timezones[0];
                updateTimeDisplay(timezoneId);
            } else {
                 document.getElementById('localTime').textContent = 'Time unavailable';
                 document.getElementById('timezone').textContent = 'N/A';
            }
            
            // Weather
            const weatherContent = document.getElementById('weatherContent');
            if (weatherData) {
                document.getElementById('weatherCity').textContent = countryData.capital;
                
                // Reset weatherContent to its default structure before populating
                weatherContent.innerHTML = `
                    <div class="flex items-center">
                        <img id="weatherIcon" class="w-20 h-20" src="" alt="Weather icon" onerror="this.onerror=null; this.src='https://placehold.co/80x80/cccccc/333333?text=N/A'">
                        <div>
                            <div id="temperature" class="text-5xl font-extrabold temp-gradient">--°C</div>
                            <div id="weatherDescription" class="text-xl capitalize text-gray-700 dark:text-gray-300"></div>
                        </div>
                    </div>
                    <div class="flex-grow grid grid-cols-3 gap-4 text-center">
                        <div><div class="text-sm font-medium text-gray-500 dark:text-gray-400">Feels Like</div><div id="feelsLike" class="text-lg font-bold text-gray-800 dark:text-white mt-1">--°C</div></div>
                        <div><div class="text-sm font-medium text-gray-500 dark:text-gray-400">Humidity</div><div id="humidity" class="text-lg font-bold text-gray-800 dark:text-white mt-1">--%</div></div>
                        <div><div class="text-sm font-medium text-gray-500 dark:text-gray-400">Wind Speed</div><div id="windSpeed" class="text-lg font-bold text-gray-800 dark:text-white mt-1">-- m/s</div></div>
                    </div>
                `;

                // Populate new structure
                document.getElementById('weatherIcon').src = 
                    `https://openweathermap.org/img/wn/${weatherData.weather[0].icon}@2x.png`;
                document.getElementById('weatherIcon').alt = weatherData.weather[0].description;
                document.getElementById('temperature').textContent = 
                    Math.round(weatherData.main.temp) + '°C';
                document.getElementById('weatherDescription').textContent = 
                    weatherData.weather[0].description;
                document.getElementById('feelsLike').textContent = 
                    Math.round(weatherData.main.feels_like) + '°C';
                document.getElementById('humidity').textContent = 
                    weatherData.main.humidity + '%';
                document.getElementById('windSpeed').textContent = 
                    weatherData.wind.speed + ' m/s';

            } else {
                document.getElementById('weatherCity').textContent = countryData.capital;
                weatherContent.innerHTML = 
                    '<div class="col text-center"><p class="text-muted text-lg font-medium">Weather data is currently unavailable.</p></div>';
            }
            
            // Show results
            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Main search function
        async function searchCountry(event) {
            event.preventDefault();
            
            const countryName = document.getElementById('countryInput').value.trim();
            if (!countryName) return;
            
            const searchBtn = document.getElementById('searchBtn');
            const originalBtnHTML = searchBtn.innerHTML;
            
            try {
                // Disable button and show loading
                searchBtn.disabled = true;
                searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
                showLoading('Searching for country...');
                
                // Clear previous results
                document.getElementById('resultSection').classList.add('hidden');
                document.getElementById('alertContainer').innerHTML = '';
                
                // Fetch country data
                const countryData = await fetchCountryData(countryName);
                
                // Fetch weather data
                showLoading(`Getting weather for ${countryData.capital}...`);
                let weatherData = null;
                
                if (countryData.capital && countryData.capital !== 'N/A') {
                    try {
                        weatherData = await fetchWeatherData(countryData.capital);
                    } catch (weatherError) {
                        console.warn('Weather data unavailable:', weatherError);
                        showAlert('Weather data is temporarily unavailable', 'warning');
                    }
                }
                
                // Display results
                displayResult(countryData, weatherData);
                
            } catch (error) {
                showAlert(error.message);
            } finally {
                // Re-enable button and hide loading
                searchBtn.disabled = false;
                searchBtn.innerHTML = originalBtnHTML;
                hideLoading();
            }
        }

        // Geolocation functionality
        async function getCurrentLocation() {
            if (!navigator.geolocation) {
                showAlert('Geolocation is not supported by this browser.', 'danger');
                return;
            }

            const locationBtn = document.querySelector('[onclick="getCurrentLocation()"]');
            const originalBtnHTML = locationBtn.innerHTML;
            
            try {
                // Disable button and show loading
                locationBtn.disabled = true;
                locationBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Getting Location...';
                showLoading('Getting your location...');
                
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        try {
                            const { latitude, longitude } = position.coords;
                            
                            showLoading('Finding your country...');
                            
                            // Use reverse geocoding
                            const response = await fetch(
                                `${CONFIG.ENDPOINTS.GEOCODING}?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`
                            );
                            
                            if (!response.ok) {
                                throw new Error('Unable to determine your location');
                            }
                            
                            const locationData = await response.json();
                            const countryName = locationData.countryName;
                            
                            if (!countryName) {
                                throw new Error('Unable to determine your country');
                            }
                            
                            // Set the country in the input
                            document.getElementById('countryInput').value = countryName;
                            
                            // Trigger search
                            const countryData = await fetchCountryData(countryName);
                            
                            showLoading(`Getting weather for ${countryData.capital}...`);
                            let weatherData = null;
                            
                            if (countryData.capital && countryData.capital !== 'N/A') {
                                try {
                                    weatherData = await fetchWeatherData(countryData.capital);
                                } catch (weatherError) {
                                    console.warn('Weather data unavailable:', weatherError);
                                    showAlert('Weather data is temporarily unavailable', 'warning');
                                }
                            }
                            
                            displayResult(countryData, weatherData);
                            
                        } catch (error) {
                            showAlert(`Location error: ${error.message}`, 'danger');
                        } finally {
                            // IMPORTANT: Always re-enable button and hide loading
                            locationBtn.disabled = false;
                            locationBtn.innerHTML = originalBtnHTML;
                            hideLoading();
                        }
                    },
                    (error) => {
                        hideLoading();
                        locationBtn.disabled = false;
                        locationBtn.innerHTML = originalBtnHTML;
                        
                        let errorMessage = 'Unable to get your location. ';
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += 'Location access was denied.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += 'Location information is unavailable.';
                                break;
                            case error.TIMEOUT:
                                errorMessage += 'Location request timed out.';
                                break;
                            default:
                                errorMessage += 'An unknown error occurred.';
                                break;
                        }
                        showAlert(errorMessage, 'danger');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: CONFIG.REQUEST_TIMEOUT,
                        maximumAge: 300000
                    }
                );
            } catch (error) {
                locationBtn.disabled = false;
                locationBtn.innerHTML = originalBtnHTML;
                hideLoading();
                showAlert(`Error: ${error.message}`, 'danger');
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // --- FIX: Removed the unnecessary config check which was causing the error ---
            
            initTheme();
            
            // Add search functionality
            document.getElementById('searchForm').addEventListener('submit', searchCountry);
            
            // Add some example suggestions
            const examples = ['Japan', 'France', 'Brazil', 'Canada', 'Australia', 'India'];
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById('countryInput').placeholder = 
                `Enter country name (e.g., ${randomExample})`;
        });

        // Cleanup interval on page unload
        window.addEventListener('beforeunload', function() {
            if (timeInterval) {
                clearInterval(timeInterval);
            }
        });
    </script>
</body>
</html>
